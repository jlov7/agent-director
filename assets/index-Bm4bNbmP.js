import{r as f,j as e}from"./vendor-react-D4yGots9.js";import{c as fe,h as Ge}from"./index-Cr9HbxxJ.js";import"./vendor-DClHNS3s.js";const Ne=/token|secret|password|api[_-]?key|authorization|bearer|session|cookie|private|ssh|credentials/i;function q(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function He(s){const l=[],d=new WeakSet,c=(n,m)=>{if(Array.isArray(n)){n.forEach((u,y)=>{c(u,`${m}[${y}]`)});return}q(n)&&(d.has(n)||(d.add(n),Object.entries(n).forEach(([u,y])=>{const C=m?`${m}.${u}`:u;Ne.test(u)&&l.push(C),c(y,C)})))};return c(s,""),l}function Se(s){const l=new WeakMap,d=c=>{if(Array.isArray(c))return c.map(m=>d(m));if(!q(c))return c;if(l.has(c))return l.get(c);const n={};return l.set(c,n),Object.entries(c).forEach(([m,u])=>{Ne.test(m)?n[m]="[REDACTED]":n[m]=d(u)}),n};return d(s)}function G(s){return q(s)}function xe(s){return s==null||Number.isNaN(s)?"n/a":s.toString()}function Ye(s){return s==null||Number.isNaN(s)?"n/a":s.toFixed(3)}function Xe(s,l){return l?Se(s):s}function Qe({job:s,matrix:l,safeExport:d,sensitiveKeys:c,anchorStepName:n}){const m=l.rows.map(u=>({scenarioId:u.scenarioId,name:u.name,strategy:u.strategy,status:u.status,replayTraceId:u.replayTraceId,modifications:Xe(u.modifications,d),error:u.error??null,changedStepIds:u.changedStepIds,addedStepIds:u.addedStepIds,removedStepIds:u.removedStepIds,metrics:u.metrics}));return{generatedAt:new Date().toISOString(),safeExport:d,redaction:{safeExport:d,sensitiveKeys:c,policy:d?"redacted":"raw"},job:s?{id:s.id,status:s.status,createdAt:s.createdAt,startedAt:s.startedAt??null,endedAt:s.endedAt??null,scenarioCount:s.scenarioCount,completedCount:s.completedCount,failedCount:s.failedCount,canceledCount:s.canceledCount}:null,base:{traceId:l.traceId,stepId:l.stepId,anchorStepName:n??null},rows:m,causalRanking:l.causalRanking}}function Ze({job:s,matrix:l,safeExport:d,anchorStepName:c}){const n=[],m=new Date().toISOString();return n.push("# Counterfactual Replay Matrix"),n.push(""),n.push(`Generated: ${m}`),n.push(`Safe export: ${d?"on":"off"}`),n.push(""),n.push("## Base trace"),n.push(`- Trace: ${l.traceId}`),n.push(`- Anchor step: ${c??l.stepId}`),n.push(""),s&&(n.push("## Job status"),n.push(`- Job: ${s.id}`),n.push(`- Status: ${s.status}`),n.push(`- Scenarios: ${s.scenarioCount} (completed ${s.completedCount}, failed ${s.failedCount}, canceled ${s.canceledCount})`),n.push("")),n.push("## Scenario outcomes"),n.push("| Scenario | Status | Wall Δ (ms) | Cost Δ (USD) | Errors Δ | Changed |"),n.push("| --- | --- | --- | --- | --- | --- |"),l.rows.forEach(u=>{n.push(`| ${u.name} | ${u.status} | ${xe(u.metrics.wallTimeDeltaMs)} | ${Ye(u.metrics.costDeltaUsd)} | ${xe(u.metrics.errorDelta)} | ${u.metrics.changedSteps} |`)}),n.push(""),n.push("## Causal ranking"),l.causalRanking.length?l.causalRanking.slice(0,10).forEach(u=>{n.push(`- ${u.factor}: score ${u.score.toFixed(3)}, confidence ${(u.confidence*100).toFixed(0)}% (samples ${u.evidence.samples})`)}):n.push("- No causal ranking available."),n.push(""),n.push("## Redaction"),n.push(`Safe export: ${d?"enabled":"disabled"}.`),n.push(""),n.join(`
`)}const ge=["recorded","live","hybrid"],O=25,w=[{id:"prompt-tighten",label:"Prompt tighten",description:"Shorten or focus the assistant response",name:"Prompt tighter",strategy:"hybrid",modifications:{prompt:"Return concise response"}},{id:"tool-timeout",label:"Tool timeout",description:"Extend tool timeout for flaky calls",name:"Tool timeout 45s",strategy:"live",modifications:{toolTimeoutMs:45e3}},{id:"recorded-baseline",label:"Recorded baseline",description:"Pure recorded replay for determinism",name:"Recorded baseline",strategy:"recorded",modifications:{}}],P=[{id:"latency-sweep",label:"Latency sweep",description:"Evaluate timeout adjustments across three live variants.",scenarios:[{name:"Timeout 15s",strategy:"live",modifications:{toolTimeoutMs:15e3}},{name:"Timeout 30s",strategy:"live",modifications:{toolTimeoutMs:3e4}},{name:"Timeout 45s",strategy:"live",modifications:{toolTimeoutMs:45e3}}]},{id:"prompt-spectrum",label:"Prompt spectrum",description:"Compare concise, balanced, and verbose response shaping.",scenarios:[{name:"Concise prompt",strategy:"hybrid",modifications:{prompt:"Return concise response"}},{name:"Balanced prompt",strategy:"hybrid",modifications:{prompt:"Return balanced detail response"}},{name:"Verbose prompt",strategy:"hybrid",modifications:{prompt:"Return comprehensive detailed response"}}]}];function be(s){return s??Number.POSITIVE_INFINITY}function _(){return`scenario-${Math.random().toString(36).slice(2,9)}`}function F(s){const l=s.trim();if(!l)return{value:{}};try{const d=JSON.parse(l);return G(d)?{value:d}:{error:"Modifications must be a JSON object."}}catch{return{error:"Modifications must be valid JSON."}}}function E(s,l=""){const d=[];return Object.entries(s).forEach(([c,n])=>{const m=l?`${l}.${c}`:c;if(typeof n=="string"||typeof n=="number"||typeof n=="boolean"||n==null){d.push({path:m,value:n});return}G(n)&&d.push(...E(n,m))}),d}function et(s,l,d){const c=l.split(".").filter(Boolean);if(c.length===0)return s;const n=JSON.parse(JSON.stringify(s));let m=n;for(let u=0;u<c.length-1;u+=1){const y=c[u],C=m[y];G(C)||(m[y]={}),m=m[y]}return m[c[c.length-1]]=d,n}function tt(s){const l=s.trim();if(l==="true")return!0;if(l==="false")return!1;if(l==="null")return null;const d=Number(l);return!Number.isNaN(d)&&l!==""?d:s}function je(s,l){const d=new Map(E(s).map(n=>[n.path,n.value]));return E(l).filter(n=>d.get(n.path)!==n.value).map(n=>({path:n.path,from:d.get(n.path)??null,to:n.value}))}function st(s){return s===null?"null":typeof s=="string"?"string":typeof s=="number"?"number":typeof s=="boolean"?"boolean":"unknown"}function nt(s){return`${s.strategy}::${JSON.stringify(s.modifications)}`}function at(s){const l=new Map;return s.scenarios.forEach(d=>{E(d.modifications).forEach(c=>{const n=l.get(c.path)??new Set;n.add(st(c.value)),l.set(c.path,n)})}),Array.from(l.entries()).filter(([,d])=>d.size>1).map(([d])=>d)}function ot(s){const l=F(s.modificationsText);return{name:s.name.trim()||"Unnamed scenario",strategy:s.strategy,modifications:l.value??{}}}function ye(s,l){const d=l.get(s);return d?d.name:s}function ct({steps:s,anchorStepId:l,onAnchorStepChange:d,scenarios:c,onScenarioChange:n,onDuplicateScenario:m,onMoveScenario:u,onAddScenario:y,onRemoveScenario:C,onReplaceScenarios:J,onRun:H,onCancel:ve,loading:N,error:Y,job:g,matrix:o,safeExport:A,onOpenCompare:Ce}){var de,ue,he,pe;const[S,Me]=f.useState("wallTimeDeltaMs"),[k,X]=f.useState(!0),[Q,Z]=f.useState(null),[ee,ke]=f.useState(((de=w[0])==null?void 0:de.id)??""),[K,Ie]=f.useState(((ue=P[0])==null?void 0:ue.id)??""),[te,I]=f.useState(null),[se,D]=f.useState(null),[L,$e]=f.useState({}),[Te,ne]=f.useState(25),ae=f.useRef(null),$=f.useMemo(()=>new Map(s.map(t=>[t.id,t])),[s]),M=f.useMemo(()=>{const t=c.map((r,i)=>r.name.trim()||`Scenario ${i+1}`),a=new Map;return t.forEach(r=>{const i=r.toLowerCase();a.set(i,(a.get(i)??0)+1)}),c.map((r,i)=>{const p=t[i],x=p.toLowerCase(),h=F(r.modificationsText),j=[];h.error&&j.push(h.error),(a.get(x)??0)>1&&j.push(`Duplicate scenario name: ${p}`);const V=h.value??{},v=h.value?He(h.value):[];return{id:r.id,name:p,parsedModifications:V,errors:j,sensitiveKeys:v}})},[c]),re=M.reduce((t,a)=>t+a.errors.length,0),U=c.length>O?`Scenario limit exceeded (${c.length}/${O}).`:null,Re=re>0||!!U,ie=U||(re>0?"Fix scenario errors before running.":null),le=!N&&c.length>0&&!Re,T=f.useMemo(()=>{const a=[...(o==null?void 0:o.rows)??[]];return a.sort((r,i)=>{if(S==="name")return k?r.name.localeCompare(i.name):i.name.localeCompare(r.name);if(S==="changedSteps"){const h=r.metrics.changedSteps,j=i.metrics.changedSteps;return k?h-j:j-h}const p=be(r.metrics[S]),x=be(i.metrics[S]);return k?p-x:x-p}),a},[o==null?void 0:o.rows,S,k]);f.useEffect(()=>{ne(25)},[o==null?void 0:o.jobId,S,k]);const R=t=>{if(t===S){X(a=>!a);return}Me(t),X(!0)},we=M.map((t,a)=>{var r;return{name:t.name,strategy:((r=c[a])==null?void 0:r.strategy)??"hybrid",modifications:t.parsedModifications}}),Ee=()=>{le&&H(we)},Ae=()=>{const t=w.find(a=>a.id===ee)??w[0];t&&J([...c,{id:_(),name:t.name,strategy:t.strategy,modificationsText:JSON.stringify(t.modifications,null,2)}])},De=()=>{const t=P.find(h=>h.id===K);if(!t){I("Select a valid profile.");return}const a=t.scenarios.map(h=>h.name.toLowerCase());if(new Set(a).size!==a.length){I("Profile has duplicate scenario names.");return}const i=t.scenarios.map(h=>nt(h));if(new Set(i).size!==i.length){I("Profile has duplicate scenario payloads.");return}const p=at(t);if(p.length>0){I(`Profile has conflicting scalar types: ${p.slice(0,3).join(", ")}`);return}const x=t.scenarios.map(h=>({id:_(),name:h.name,strategy:h.strategy,modificationsText:JSON.stringify(h.modifications,null,2)}));J(x),I(null),H(x.map(h=>({name:h.name,strategy:h.strategy,modifications:F(h.modificationsText).value??{}})))},Oe=(t,a,r)=>{const i=c.find(h=>h.id===t);if(!i)return;const p=F(i.modificationsText);if(!p.value)return;const x=et(p.value,a,tt(r));n(t,{modificationsText:JSON.stringify(x,null,2)})},Pe=()=>{const t={version:1,anchorStepId:l,scenarios:c.map(a=>({name:a.name,strategy:a.strategy,modificationsText:a.modificationsText}))};fe(`agent-director-scenarios-${l||"matrix"}.json`,t)},Fe=async t=>{var r;const a=(r=t.target.files)==null?void 0:r[0];if(a){t.target.value="";try{const i=await a.text(),p=JSON.parse(i),x=Array.isArray(p.scenarios)?p.scenarios:Array.isArray(p)?p:null;if(!x||x.length===0){D("Scenario file must include a scenarios array.");return}if(x.length>O){D(`Scenario file exceeds ${O} scenarios.`);return}const h=x.map((j,V)=>{if(!j||typeof j!="object")throw new Error("Scenario entries must be objects.");const v=j,Ve=String(v.name??`Scenario ${V+1}`),me=String(v.strategy??"hybrid"),_e=ge.includes(me)?me:"hybrid",qe=typeof v.modificationsText=="string"?v.modificationsText:JSON.stringify(v.modifications??{},null,2);return{id:_(),name:Ve,strategy:_e,modificationsText:qe}});typeof p.anchorStepId=="string"&&$.has(p.anchorStepId)&&d(p.anchorStepId),J(h),D(null)}catch(i){D(i instanceof Error?i.message:"Failed to import scenario file.")}}},Je=f.useMemo(()=>{const t=M.flatMap(a=>a.sensitiveKeys);return Array.from(new Set(t))},[M]),Ke=f.useMemo(()=>{const t=(o==null?void 0:o.causalRanking)??[];return t.length===0?1:Math.max(1,...t.map(a=>Math.abs(a.score)))},[o==null?void 0:o.causalRanking]),oe=((he=M[0])==null?void 0:he.parsedModifications)??{},W=f.useMemo(()=>Object.entries(L).filter(([,a])=>a!==0).reduce((a,[r,i])=>{const p=o==null?void 0:o.causalRanking.find(j=>j.factor===r),x=(p==null?void 0:p.score)??0,h=i/100;return a.wallTimeMs+=x*h*1400,a.costUsd+=x*h*.04,a.errorDelta+=x*h*.7,a},{wallTimeMs:0,costUsd:0,errorDelta:0}),[o==null?void 0:o.causalRanking,L]),z=f.useMemo(()=>{const t=new Map;return((o==null?void 0:o.rows)??[]).forEach(a=>{const r=Math.abs(a.metrics.wallTimeDeltaMs??0)+Math.abs((a.metrics.costDeltaUsd??0)*1e3)+Math.abs(a.metrics.errorDelta??0)*400;a.changedStepIds.forEach(i=>{t.set(i,(t.get(i)??0)+Math.max(1,r))})}),Array.from(t.entries()).sort((a,r)=>r[1]-a[1]).slice(0,10)},[o==null?void 0:o.rows]),Le=Math.max(1,...z.map(([,t])=>t),1),ce=f.useMemo(()=>((o==null?void 0:o.causalRanking)??[]).slice(0,5).map(t=>({id:t.factor,text:`${t.factor} -> ${t.evidence.examples[0]??"observed change"} -> outcome`,confidence:t.confidence})),[o==null?void 0:o.causalRanking]),B=T.slice(0,Te),Ue=()=>{var r;if(!o)return;const t=((r=$.get(l))==null?void 0:r.name)??null,a=Qe({job:g,matrix:o,safeExport:A,sensitiveKeys:Je,anchorStepName:t});fe(`agent-director-matrix-${o.jobId}.json`,a)},We=()=>{var r;if(!o)return;const t=((r=$.get(l))==null?void 0:r.name)??null,a=Ze({job:g,matrix:o,safeExport:A,anchorStepName:t});Ge(`agent-director-matrix-${o.jobId}.md`,a,"text/markdown")},ze=(g==null?void 0:g.status)==="queued"||(g==null?void 0:g.status)==="running",b=Q?((o==null?void 0:o.rows)??[]).find(t=>t.scenarioId===Q)??null:null,Be=b?A?Se(b.modifications):b.modifications:null;return e.jsxs("section",{className:"matrix-mode","data-help":!0,"data-help-title":"Matrix mode","data-help-body":"Run multiple replay scenarios from one anchor and compare outcome deltas with causal ranking.","data-help-placement":"top",children:[e.jsxs("div",{className:"matrix-panel",children:[e.jsxs("div",{className:"matrix-panel-header",children:[e.jsx("h2",{children:"Counterfactual Replay Matrix"}),e.jsx("div",{className:"matrix-job-state",children:g?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:`status-pill status-${g.status}`,children:["Job: ",g.status]}),e.jsxs("span",{children:[g.completedCount,"/",g.scenarioCount," completed"]}),g.failedCount?e.jsxs("span",{children:[g.failedCount," failed"]}):null,g.canceledCount?e.jsxs("span",{children:[g.canceledCount," canceled"]}):null]}):e.jsx("span",{children:"No job yet"})})]}),e.jsxs("div",{className:"matrix-controls",children:[e.jsxs("label",{children:["Anchor step",e.jsx("select",{value:l,onChange:t=>d(t.target.value),children:s.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.id,")"]},t.id))})]}),e.jsxs("label",{children:["Preset",e.jsx("select",{value:ee,onChange:t=>ke(t.target.value),"data-help":!0,"data-help-title":"Scenario presets","data-help-body":"Insert common experiments like prompt tweaks or recorded baselines.","data-help-placement":"bottom",children:w.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))})]}),e.jsxs("label",{children:["Batch profile",e.jsx("select",{value:K,onChange:t=>Ie(t.target.value),children:P.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))})]}),e.jsx("button",{type:"button",className:"ghost-button",onClick:Ae,disabled:N,"data-help":!0,"data-help-title":"Add preset","data-help-body":"Append the selected preset as a new scenario.","data-help-placement":"bottom",children:"Add preset"}),e.jsx("button",{type:"button",className:"ghost-button",onClick:De,disabled:N,"data-help":!0,"data-help-title":"Run batch profile","data-help-body":"Loads and executes a predefined scenario orchestration profile.","data-help-placement":"bottom",children:"Run profile"}),e.jsxs("div",{className:"matrix-actions",children:[e.jsx("button",{type:"button",className:"primary-button",onClick:Ee,disabled:!le,"data-help":!0,"data-help-title":"Run matrix","data-help-body":"Execute all scenarios sequentially and gather outcome deltas.","data-help-placement":"bottom",children:N?"Running...":"Run matrix"}),e.jsx("button",{type:"button",className:"ghost-button",onClick:y,disabled:N,children:"Add scenario"}),e.jsx("button",{type:"button",className:"ghost-button",onClick:ve,disabled:!ze||N,children:"Cancel job"}),e.jsx("button",{type:"button",className:"ghost-button",onClick:Pe,"data-help":!0,"data-help-title":"Export scenarios","data-help-body":"Download the scenario set as JSON for reuse.","data-help-placement":"bottom",children:"Export scenarios"}),e.jsx("button",{type:"button",className:"ghost-button",onClick:()=>{var t;return(t=ae.current)==null?void 0:t.click()},"data-help":!0,"data-help-title":"Import scenarios","data-help-body":"Load a scenario JSON file to repopulate the builder.","data-help-placement":"bottom",children:"Import scenarios"}),e.jsx("input",{ref:ae,type:"file",accept:"application/json",onChange:Fe,className:"matrix-file-input"}),e.jsx("button",{type:"button",className:"ghost-button",onClick:Ue,disabled:!o,"data-help":!0,"data-help-title":"Export matrix","data-help-body":"Download the full matrix JSON with redaction metadata.","data-help-placement":"bottom",children:"Export matrix"}),e.jsx("button",{type:"button",className:"ghost-button",onClick:We,disabled:!o,"data-help":!0,"data-help-title":"Export summary","data-help-body":"Download a markdown summary for sharing.","data-help-placement":"bottom",children:"Export summary"})]})]}),e.jsxs("div",{className:"matrix-presets",children:[w.map(t=>e.jsxs("div",{className:"matrix-preset",children:[e.jsx("strong",{children:t.label}),e.jsx("span",{children:t.description})]},t.id)),P.filter(t=>t.id===K).map(t=>e.jsxs("div",{className:"matrix-preset profile",children:[e.jsx("strong",{children:t.label}),e.jsx("span",{children:t.description})]},t.id))]}),e.jsx("div",{className:"matrix-scenarios",children:c.map((t,a)=>{const r=M[a];return e.jsxs("article",{className:"matrix-scenario",children:[e.jsxs("div",{className:"matrix-scenario-head",children:[e.jsx("input",{value:t.name,onChange:i=>n(t.id,{name:i.target.value}),placeholder:"Scenario name"}),e.jsx("select",{value:t.strategy,onChange:i=>n(t.id,{strategy:i.target.value}),children:ge.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsx("textarea",{value:t.modificationsText,onChange:i=>n(t.id,{modificationsText:i.target.value}),rows:3,spellCheck:!1,"aria-label":`Scenario ${t.name} modifications`}),r?e.jsxs("div",{className:"matrix-schema-editor",children:[e.jsx("strong",{children:"Schema-aware scalar editor"}),e.jsx("div",{className:"matrix-schema-grid",children:E(r.parsedModifications).slice(0,8).map(i=>e.jsxs("label",{className:"matrix-schema-field",children:[e.jsx("span",{children:i.path}),e.jsx("input",{value:String(i.value??""),onChange:p=>Oe(t.id,i.path,p.target.value)})]},`${t.id}-${i.path}`))})]}):null,e.jsxs("div",{className:"matrix-diff-preview",children:[e.jsx("strong",{children:"Diff vs baseline"}),e.jsxs("div",{className:"matrix-diff-list",children:[je(oe,(r==null?void 0:r.parsedModifications)??{}).slice(0,6).map(i=>e.jsxs("div",{className:"matrix-diff-item",children:[e.jsx("span",{children:i.path}),e.jsxs("span",{children:[String(i.from)," ","->"," ",String(i.to)]})]},`${t.id}-${i.path}`)),je(oe,(r==null?void 0:r.parsedModifications)??{}).length===0?e.jsx("div",{className:"matrix-diff-item",children:"No scalar changes from baseline."}):null]})]}),r!=null&&r.errors.length?e.jsx("div",{className:"matrix-scenario-error",children:r.errors.map(i=>e.jsx("div",{children:i},i))}):null,r!=null&&r.sensitiveKeys.length?e.jsxs("div",{className:"matrix-scenario-warning",children:["Sensitive keys: ",r.sensitiveKeys.join(", ")]}):null,e.jsxs("div",{className:"matrix-scenario-actions",children:[e.jsx("button",{type:"button",className:"ghost-button",onClick:()=>m(t.id),disabled:N,children:"Duplicate scenario"}),e.jsx("button",{type:"button",className:"ghost-button",onClick:()=>u(t.id,"up"),disabled:N||a===0,children:"Move scenario up"}),e.jsx("button",{type:"button",className:"ghost-button",onClick:()=>u(t.id,"down"),disabled:N||a===c.length-1,children:"Move scenario down"}),e.jsx("button",{type:"button",className:"ghost-button",onClick:()=>C(t.id),disabled:c.length<=1,children:"Remove"})]})]},t.id)})}),ie?e.jsx("div",{className:"error-banner",children:ie}):null,se?e.jsx("div",{className:"error-banner",children:se}):null,te?e.jsx("div",{className:"error-banner",children:te}):null,Y?e.jsx("div",{className:"error-banner",children:Y}):null]}),e.jsxs("div",{className:"matrix-results",children:[e.jsxs("div",{className:"matrix-table-wrap",children:[e.jsxs("table",{className:"matrix-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx("button",{type:"button",className:"table-sort",onClick:()=>R("name"),children:"Scenario"})}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:e.jsx("button",{type:"button",className:"table-sort",onClick:()=>R("wallTimeDeltaMs"),children:"Wall Δ (ms)"})}),e.jsx("th",{children:e.jsx("button",{type:"button",className:"table-sort",onClick:()=>R("costDeltaUsd"),children:"Cost Δ (USD)"})}),e.jsx("th",{children:e.jsx("button",{type:"button",className:"table-sort",onClick:()=>R("errorDelta"),children:"Errors Δ"})}),e.jsx("th",{children:e.jsx("button",{type:"button",className:"table-sort",onClick:()=>R("changedSteps"),children:"Changed"})}),e.jsx("th",{children:"Details"}),e.jsx("th",{children:"Compare"})]})}),e.jsx("tbody",{children:T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:"No matrix results yet. Run a job to populate this table."})}):B.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.name}),e.jsx("td",{title:t.error??void 0,children:t.status}),e.jsx("td",{children:t.metrics.wallTimeDeltaMs??"n/a"}),e.jsx("td",{children:t.metrics.costDeltaUsd??"n/a"}),e.jsx("td",{children:t.metrics.errorDelta??"n/a"}),e.jsx("td",{children:t.metrics.changedSteps}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"ghost-button",onClick:()=>Z(t.scenarioId),children:"Details"})}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"ghost-button",disabled:!t.replayTraceId,onClick:()=>t.replayTraceId&&Ce(t.replayTraceId),children:"Open"})})]},t.scenarioId))})]}),T.length>B.length?e.jsx("div",{className:"matrix-table-more",children:e.jsxs("button",{type:"button",className:"ghost-button",onClick:()=>ne(t=>Math.min(T.length,t+25)),children:["Load more rows (",B.length,"/",T.length,")"]})}):null]}),e.jsxs("aside",{className:"matrix-causal",children:[e.jsx("h3",{children:"Causal ranking"}),(pe=o==null?void 0:o.causalRanking)!=null&&pe.length?e.jsxs(e.Fragment,{children:[e.jsx("ul",{children:o.causalRanking.slice(0,8).map(t=>e.jsxs("li",{children:[e.jsxs("div",{className:"factor-row",children:[e.jsx("strong",{children:t.factor}),e.jsxs("span",{children:["score ",t.score.toFixed(3)]})]}),e.jsx("div",{className:"factor-bar-track",role:"presentation",children:e.jsx("div",{className:`factor-bar-fill ${t.score>=0?"positive":"negative"}`,style:{width:`${Math.max(6,Math.abs(t.score)/Ke*100)}%`}})}),e.jsxs("div",{className:"factor-meta",children:["confidence ",(t.confidence*100).toFixed(0),"% • samples ",t.evidence.samples]}),e.jsx("input",{type:"range",min:-100,max:100,value:L[t.factor]??0,"aria-label":`Simulate ${t.factor}`,onChange:a=>$e(r=>({...r,[t.factor]:Number(a.target.value)}))}),t.evidence.examples.length?e.jsx("div",{className:"factor-chips",children:t.evidence.examples.map(a=>e.jsx("span",{className:"factor-chip",children:a},a))}):null]},t.factor))}),e.jsxs("div",{className:"matrix-projected",children:[e.jsx("h4",{children:"Projected impact (simulation)"}),e.jsxs("div",{className:"matrix-projected-grid",children:[e.jsxs("span",{children:["Wall Δ ",W.wallTimeMs.toFixed(0)," ms"]}),e.jsxs("span",{children:["Cost Δ ",W.costUsd.toFixed(3)," USD"]}),e.jsxs("span",{children:["Error Δ ",W.errorDelta.toFixed(2)]})]})]}),e.jsxs("div",{className:"matrix-heatmap",children:[e.jsx("h4",{children:"Step influence heatmap"}),z.map(([t,a])=>e.jsxs("div",{className:"matrix-heatmap-row",children:[e.jsx("span",{children:ye(t,$)}),e.jsx("span",{className:"matrix-heatmap-bar",style:{width:`${Math.max(5,a/Le*100)}%`}})]},t)),z.length===0?e.jsx("p",{children:"No influence data yet."}):null]}),e.jsxs("div",{className:"matrix-paths",children:[e.jsx("h4",{children:"Causal path explorer"}),ce.map(t=>e.jsxs("div",{className:"matrix-path-item",children:[e.jsx("span",{children:t.text}),e.jsxs("span",{children:[(t.confidence*100).toFixed(0),"%"]})]},t.id)),ce.length===0?e.jsx("p",{children:"No paths available."}):null]})]}):e.jsx("p",{children:"No causal ranking yet."})]}),b?e.jsxs("aside",{className:"matrix-detail",role:"dialog","aria-label":"Scenario details",children:[e.jsxs("div",{className:"matrix-detail-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Scenario details"}),e.jsxs("p",{className:"matrix-detail-subtitle",children:[b.name," • ",b.status]})]}),e.jsx("button",{type:"button",className:"ghost-button",onClick:()=>Z(null),children:"Close"})]}),e.jsxs("div",{className:"matrix-detail-grid",children:[e.jsxs("div",{className:"matrix-detail-block",children:[e.jsx("h4",{children:"Modifications"}),A?e.jsx("p",{className:"matrix-detail-note",children:"Safe export enabled: sensitive keys are redacted."}):null,e.jsx("pre",{children:JSON.stringify(Be??{},null,2)})]}),e.jsxs("div",{className:"matrix-detail-block",children:[e.jsx("h4",{children:"Change summary"}),e.jsxs("div",{className:"matrix-detail-metrics",children:[e.jsxs("span",{children:["Changed: ",b.metrics.changedSteps]}),e.jsxs("span",{children:["Added: ",b.metrics.addedSteps]}),e.jsxs("span",{children:["Removed: ",b.metrics.removedSteps]}),e.jsxs("span",{children:["Invalidated: ",b.metrics.invalidatedStepCount]})]}),e.jsxs("div",{className:"matrix-detail-steps",children:[e.jsx("strong",{children:"Top changed steps"}),e.jsx("div",{className:"matrix-step-chips",children:b.changedStepIds.length?b.changedStepIds.slice(0,6).map(t=>e.jsx("span",{className:"matrix-step-chip",title:t,children:ye(t,$)},t)):e.jsx("span",{className:"matrix-step-chip",children:"None"})}),b.changedStepIds.length>6?e.jsxs("div",{className:"matrix-step-more",children:["+",b.changedStepIds.length-6," more steps changed"]}):null]}),b.error?e.jsx("div",{className:"matrix-detail-error",children:b.error}):null]})]})]}):null]})]})}export{ct as default,ot as toScenarioInput};
