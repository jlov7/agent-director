import{r as c,j as e,k as he,l as ge,m as xe,n as K,o as je,u as be,p as ve,q as A,t as Ne,v as ye,w as ke,x as I,y as fe,z as T,A as Q,B as Y,C as Ce,D as _e,E as Fe,F as Se,G as Me}from"./index-CX8jsKR6.js";function Re(a,b,v){return Math.min(v,Math.max(b,a))}function we({state:a,playheadMs:b,onUpdate:v,session:r,playerId:p,sessionError:q,onCreateSession:C,onJoinSession:u,onLeaveSession:_,onDispatchAction:N,guild:m,onCreateGuild:F,onJoinGuild:S,onScheduleGuildEvent:M,onCompleteGuildEvent:R,observability:n,analytics:t}){const[g,B]=c.useState(""),[P,J]=c.useState("strategist"),[w,ee]=c.useState("alt path"),[E,se]=c.useState("Night Ops"),[z,ae]=c.useState(""),[H,le]=c.useState("operator"),[y,ne]=c.useState("guild-night-ops"),[W,ie]=c.useState("Night Ops Guild"),[U,te]=c.useState("Weekly Raid Drill"),[X,ce]=c.useState("2026-02-16T20:00:00Z"),[d,re]=c.useState(""),[O,oe]=c.useState("Abusive behavior"),[Z,de]=c.useState("1"),[$,pe]=c.useState("1"),[D,ue]=c.useState("Weekly balance update"),G=!!(r!=null&&r.id&&N),l=(s,i,o)=>{if(G){N==null||N(s,i);return}v(o)},h=c.useMemo(()=>a.narrative.nodes.find(s=>s.id===a.narrative.currentNodeId),[a.narrative.currentNodeId,a.narrative.nodes]),L=c.useMemo(()=>{var o;const s=[a.raid.completed,a.campaign.depth>=3,a.narrative.history.length>=2,a.skills.loadout.equipped.length>=2,a.pvp.round>=3||a.pvp.winner!=null,a.time.forks.length>=2||((o=a.time.forks[0])==null?void 0:o.history.length)>1,a.boss.hp<a.boss.maxHp,a.director.lastOutcome!=="mixed",a.economy.crafted.length>=1,a.guild.operationsScore>0,a.cinematic.queue.length>=1,a.liveops.week>=2],i=s.filter(Boolean).length;return{done:i,total:s.length,pct:Math.round(i/s.length*100)}},[a]),x=a.safety??{mutedPlayerIds:[],blockedPlayerIds:[],reports:[]},k=a.sandbox??{enabled:!1},f=a.progression??{xp:0,level:1,nextLevelXp:200,milestones:[]},j=c.useMemo(()=>a.outcome.status==="win"||a.outcome.status==="loss"?4:a.raid.objectives.some(i=>i.progress>0)||a.pvp.round>0||a.time.forks.length>1?a.campaign.depth>1||a.narrative.history.length>0?3:2:1,[a]);return e.jsxs("section",{className:"gameplay-mode",children:[e.jsxs("header",{className:"gameplay-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Gameplay Command Center"}),e.jsx("p",{children:"World-class mechanics stack: raids, campaign, narrative, PvP, time control, boss runs, and liveops."}),e.jsx("p",{children:"v1 core loop target session length: 18-22 minutes."}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("input",{className:"search-input",value:E,onChange:s=>se(s.target.value),placeholder:"Session name","aria-label":"Session name"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>C==null?void 0:C(E),children:"Create multiplayer session"}),e.jsx("input",{className:"search-input",value:z,onChange:s=>ae(s.target.value),placeholder:"Session id","aria-label":"Join session id"}),e.jsxs("select",{value:H,onChange:s=>le(s.target.value),children:[e.jsx("option",{value:"strategist",children:"Strategist"}),e.jsx("option",{value:"operator",children:"Operator"}),e.jsx("option",{value:"analyst",children:"Analyst"}),e.jsx("option",{value:"saboteur",children:"Saboteur"})]}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>u==null?void 0:u(z,p??"director",H),children:"Join session"}),r!=null&&r.id?e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>_==null?void 0:_(),children:"Leave session"}):null]}),e.jsxs("p",{children:["Session: ",(r==null?void 0:r.id)??"local-only"," ",p?`• Player ${p}`:""," ",r?`• Version ${r.version}`:""]}),q?e.jsx("p",{children:q}):null]}),e.jsxs("div",{className:"gameplay-completion","aria-label":"Gameplay completion",children:[e.jsxs("strong",{children:[L.done,"/",L.total]}),e.jsxs("span",{children:[L.pct,"% complete"]})]})]}),e.jsxs("div",{className:"gameplay-grid",children:[e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"0) Core Loop + Outcomes"}),e.jsxs("p",{children:["Phase ",j,"/4 • Outcome ",a.outcome.status.replace("_"," ")," • Sandbox"," ",k.enabled?"ON":"OFF"]}),e.jsx("p",{children:a.outcome.reason}),e.jsx("div",{className:"gameplay-inline",children:e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("session.toggle_sandbox",{enabled:!k.enabled},s=>ge(s,!k.enabled)),children:k.enabled?"Disable sandbox":"Enable sandbox"})}),e.jsxs("div",{className:"gameplay-list",children:[e.jsx("div",{className:"gameplay-node",children:e.jsxs("span",{children:[j>=1?"x":"o"," Brief: inspect run and set objective"]})}),e.jsx("div",{className:"gameplay-node",children:e.jsxs("span",{children:[j>=2?"x":"o"," Execute: complete raid and mission actions"]})}),e.jsx("div",{className:"gameplay-node",children:e.jsxs("span",{children:[j>=3?"x":"o"," Adapt: choose narrative and tune loadout/liveops"]})}),e.jsx("div",{className:"gameplay-node",children:e.jsxs("span",{children:[j>=4?"x":"o"," Resolve: finish with win/loss review"]})})]}),e.jsxs("div",{className:"gameplay-list",children:[e.jsx("p",{children:"Telemetry funnels:"}),e.jsx("div",{className:"gameplay-node",children:e.jsx("span",{children:"funnel.session_start"})}),e.jsx("div",{className:"gameplay-node",children:e.jsx("span",{children:"funnel.first_objective_progress"})}),e.jsx("div",{className:"gameplay-node",children:e.jsx("span",{children:"funnel.first_mission_outcome"})}),e.jsx("div",{className:"gameplay-node",children:e.jsx("span",{children:"funnel.run_outcome"})})]})]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"1) Co-op Incident Raids"}),e.jsxs("p",{children:["Party: ",a.raid.party.length," members"]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("input",{className:"search-input",value:g,onChange:s=>B(s.target.value),placeholder:"Member name","aria-label":"Raid member name"}),e.jsxs("select",{value:P,onChange:s=>J(s.target.value),children:[e.jsx("option",{value:"strategist",children:"Strategist"}),e.jsx("option",{value:"operator",children:"Operator"}),e.jsx("option",{value:"analyst",children:"Analyst"}),e.jsx("option",{value:"saboteur",children:"Saboteur"})]}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>{g.trim()&&(G?u==null||u((r==null?void 0:r.id)??"",g.trim(),P):v(s=>he(s,g.trim(),P)),B(""))},children:"Add member"})]}),e.jsx("div",{className:"gameplay-objectives",children:a.raid.objectives.map(s=>e.jsxs("div",{className:"gameplay-objective",children:[e.jsx("span",{children:s.label}),e.jsxs("span",{children:[s.progress,"/",s.target]}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("raid.objective_progress",{objective_id:s.id,delta:25},i=>xe(i,s.id,25)),children:"+25"})]},s.id))})]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"2) Roguelike Scenario Campaign"}),e.jsxs("p",{children:["Depth ",a.campaign.depth," • Lives ",a.campaign.lives]}),e.jsxs("p",{children:[a.campaign.currentMission.title," (difficulty ",a.campaign.currentMission.difficulty,")"]}),e.jsx("p",{children:"Difficulty ramp bands: D1-1, D2-3, D4-5, D6-7, D8-9, D10+."}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("button",{className:"primary-button",type:"button",onClick:()=>l("campaign.resolve_mission",{success:!0},s=>K(s,!0)),children:"Mission success"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("campaign.resolve_mission",{success:!1},s=>K(s,!1)),children:"Mission fail"})]})]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"3) Branching Narrative Director"}),e.jsx("p",{children:h==null?void 0:h.title}),e.jsxs("p",{children:["Tension ",a.narrative.tension]}),e.jsx("div",{className:"gameplay-list",children:((h==null?void 0:h.choices)??[]).map(s=>e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("narrative.choose",{choice_id:s.id},i=>je(i,s.id)),children:s.label},s.id))})]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"4) Skill Tree + Loadout"}),e.jsxs("p",{children:["Level ",f.level," • XP ",f.xp,"/",f.nextLevelXp," • Milestones"," ",f.milestones.length]}),e.jsxs("p",{children:["Points ",a.skills.points," • Equipped ",a.skills.loadout.equipped.length,"/",a.skills.loadout.capacity]}),e.jsx("div",{className:"gameplay-list",children:a.skills.nodes.map(s=>e.jsxs("div",{className:"gameplay-node",children:[e.jsxs("span",{children:[s.label," (",s.cost,")"]}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("skills.unlock",{player_id:p??"director",skill_id:s.id},i=>be(i,s.id)),children:s.unlocked?"Unlocked":"Unlock"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("skills.equip",{player_id:p??"director",skill_id:s.id},i=>ve(i,s.id)),children:"Equip"})]},s.id))})]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"5) Asymmetric PvP"}),e.jsxs("p",{children:["Round ",a.pvp.round," • Stability ",a.pvp.stability," • Sabotage ",a.pvp.sabotage]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("pvp.act",{action:"sabotage"},s=>A(s,"sabotage")),children:"Sabotage"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("pvp.act",{action:"stabilize"},s=>A(s,"stabilize")),children:"Stabilize"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("pvp.act",{action:"scan"},s=>A(s,"scan")),children:"Scan"})]})]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"6) Time Manipulation"}),e.jsxs("p",{children:["Active fork: ",a.time.activeForkId]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("input",{className:"search-input",value:w,onChange:s=>ee(s.target.value),"aria-label":"Fork label"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("time.create_fork",{label:w,playhead_ms:b},s=>Ne(s,w,b)),children:"Create fork"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("time.rewind",{amount_ms:1e3},s=>ye(s,1e3)),children:"Rewind 1s"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("time.merge",{fork_id:a.time.activeForkId},s=>ke(s,s.time.activeForkId)),children:"Merge"})]})]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"7) Boss Encounter Runs"}),e.jsxs("p",{children:[a.boss.name," • Phase ",a.boss.phase," • HP ",a.boss.hp,"/",a.boss.maxHp]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("boss.act",{action:"strike"},s=>I(s,"strike")),children:"Strike"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("boss.act",{action:"shield"},s=>I(s,"shield")),children:"Shield"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("boss.act",{action:"exploit"},s=>I(s,"exploit")),children:"Exploit"})]})]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"8) Adaptive AI Dungeon Master"}),e.jsxs("p",{children:["Risk ",a.director.risk," • Outcome ",a.director.lastOutcome]}),e.jsx("p",{children:a.director.hint}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>{var V;const s=a.pvp.sabotage>a.pvp.stability?2:0,i=Math.floor((((V=a.raid.objectives[0])==null?void 0:V.progress)??0)/40),o=900+a.pvp.fog*10;l("director.evaluate",{failures:s,retries:i,latency_ms:o},me=>fe(me,{failures:s,retries:i,latencyMs:o}))},children:"Recompute guidance"})]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"9) Mission Economy + Crafting"}),e.jsxs("p",{children:["Credits ",a.economy.credits," • Materials ",a.economy.materials]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("economy.craft",{recipe_id:"stability_patch"},s=>T(s,"stability_patch")),children:"Craft stability patch"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("economy.craft",{recipe_id:"precision_lens"},s=>T(s,"precision_lens")),children:"Craft precision lens"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("economy.craft",{recipe_id:"overclock_core"},s=>T(s,"overclock_core")),children:"Craft overclock core"})]})]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"10) Guild Operations"}),e.jsxs("p",{children:[a.guild.name," • Ops score ",a.guild.operationsScore," • Events ",a.guild.eventsCompleted]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("input",{className:"search-input",value:y,onChange:s=>ne(s.target.value),placeholder:"Guild id","aria-label":"Guild id"}),e.jsx("input",{className:"search-input",value:W,onChange:s=>ie(s.target.value),placeholder:"Guild name","aria-label":"Guild name"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>F==null?void 0:F(y,W),children:"Create guild"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>S==null?void 0:S(y,g.trim()||p||"director"),children:"Join guild"})]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("input",{className:"search-input",value:U,onChange:s=>te(s.target.value),placeholder:"Event title","aria-label":"Guild event title"}),e.jsx("input",{className:"search-input",value:X,onChange:s=>ce(s.target.value),placeholder:"2026-02-16T20:00:00Z","aria-label":"Guild event schedule"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>M==null?void 0:M(y,U,X),children:"Schedule event"})]}),m?e.jsxs("div",{className:"gameplay-list",children:[e.jsxs("p",{children:[m.member_count," members • Score ",m.operations_score]}),m.scoreboard.slice(0,4).map(s=>e.jsxs("div",{className:"gameplay-node",children:[e.jsx("span",{children:s.player_id}),e.jsx("span",{children:s.score})]},s.player_id)),m.events.slice(-3).map(s=>e.jsxs("div",{className:"gameplay-node",children:[e.jsx("span",{children:s.title}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>R==null?void 0:R(m.id,s.id,10),children:"Complete"})]},s.id))]}):null,e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("guild.op",{impact:6},s=>Q(s,6)),children:"Positive op"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("guild.op",{impact:-3},s=>Q(s,-3)),children:"Risky op"})]})]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"11) Cinematic Event Engine"}),e.jsxs("p",{children:[a.cinematic.queue.length," queued events"]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("cinematic.emit",{event_type:"critical",message:"Critical cascade detected",intensity:3},s=>Y(s,"critical","Critical cascade detected",3)),children:"Critical beat"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("cinematic.emit",{event_type:"success",message:"System stabilizing",intensity:2},s=>Y(s,"success","System stabilizing",2)),children:"Success beat"})]})]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"12) Seasonal LiveOps"}),e.jsxs("p",{children:[a.liveops.season," • Week ",a.liveops.week]}),e.jsx("p",{children:a.liveops.challenge.title}),e.jsxs("p",{children:["Difficulty x",a.liveops.difficultyFactor.toFixed(2)," • Reward x",a.liveops.rewardMultiplier.toFixed(2)]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("liveops.advance_week",{},s=>Ce(s)),children:"Next week"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("liveops.progress",{delta:1},s=>({...s,liveops:{...s.liveops,challenge:{...s.liveops.challenge,progress:Re(s.liveops.challenge.progress+1,0,s.liveops.challenge.goal),completed:s.liveops.challenge.progress+1>=s.liveops.challenge.goal}}})),children:"Progress challenge"})]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("input",{className:"search-input",value:Z,onChange:s=>de(s.target.value),placeholder:"Difficulty (0.6-1.6)","aria-label":"LiveOps difficulty factor"}),e.jsx("input",{className:"search-input",value:$,onChange:s=>pe(s.target.value),placeholder:"Reward (0.5-2.0)","aria-label":"LiveOps reward multiplier"})]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("input",{className:"search-input",value:D,onChange:s=>ue(s.target.value),placeholder:"Tuning note","aria-label":"LiveOps tuning note"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>{const s=Number.parseFloat(Z),i=Number.parseFloat($);l("liveops.balance",{difficulty_factor:Number.isFinite(s)?s:1,reward_multiplier:Number.isFinite(i)?i:1,note:D},o=>_e(o,{difficultyFactor:Number.isFinite(s)?s:1,rewardMultiplier:Number.isFinite(i)?i:1,note:D}))},children:"Apply balancing"})]}),a.liveops.tuningHistory.length>0?e.jsx("div",{className:"gameplay-list",children:a.liveops.tuningHistory.slice(0,3).map(s=>e.jsxs("div",{className:"gameplay-node",children:[e.jsxs("span",{children:[new Date(s.changedAt).toLocaleDateString()," • ",s.note]}),e.jsxs("span",{children:["D x",s.difficultyFactor.toFixed(2)," / R x",s.rewardMultiplier.toFixed(2)]})]},s.id))}):null]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"13) Safety and Moderation"}),e.jsxs("p",{children:["Muted ",x.mutedPlayerIds.length," • Blocked ",x.blockedPlayerIds.length," • Reports"," ",x.reports.length]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("input",{className:"search-input",value:d,onChange:s=>re(s.target.value),placeholder:"Player id","aria-label":"Safety player id"}),e.jsx("input",{className:"search-input",value:O,onChange:s=>oe(s.target.value),placeholder:"Reason","aria-label":"Safety reason"})]}),e.jsxs("div",{className:"gameplay-inline",children:[e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("safety.mute",{target_player_id:d},s=>Fe(s,d)),children:"Mute player"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("safety.block",{target_player_id:d},s=>Se(s,d)),children:"Block player"}),e.jsx("button",{className:"ghost-button",type:"button",onClick:()=>l("safety.report",{target_player_id:d,reason:O},s=>Me(s,d,O)),children:"Report player"})]}),x.reports.length>0?e.jsx("div",{className:"gameplay-list",children:x.reports.slice(0,3).map(s=>e.jsxs("div",{className:"gameplay-node",children:[e.jsx("span",{children:s.targetPlayerId}),e.jsx("span",{children:s.reason})]},s.id))}):null]}),e.jsxs("article",{className:"gameplay-card",children:[e.jsx("h3",{children:"14) Observability + Funnel Analytics"}),e.jsxs("p",{children:["Sessions ",(n==null?void 0:n.metrics.total_sessions)??0," • Running ",(n==null?void 0:n.metrics.running_sessions)??0]}),e.jsxs("p",{children:["Avg latency ",Math.round((n==null?void 0:n.metrics.avg_latency_ms)??0),"ms • P95"," ",Math.round((n==null?void 0:n.metrics.p95_latency_ms)??0),"ms"]}),e.jsxs("p",{children:["Failure rate ",((n==null?void 0:n.metrics.failure_rate_pct)??0).toFixed(2),"% • Challenge completion"," ",((n==null?void 0:n.metrics.challenge_completion_rate_pct)??0).toFixed(2),"%"]}),e.jsxs("div",{className:"gameplay-list",children:[e.jsx("p",{children:"Funnels"}),e.jsxs("div",{className:"gameplay-node",children:[e.jsx("span",{children:"Session start"}),e.jsx("span",{children:(t==null?void 0:t.funnels.session_start)??0})]}),e.jsxs("div",{className:"gameplay-node",children:[e.jsx("span",{children:"First objective progress"}),e.jsx("span",{children:(t==null?void 0:t.funnels.first_objective_progress)??0})]}),e.jsxs("div",{className:"gameplay-node",children:[e.jsx("span",{children:"First mission outcome"}),e.jsx("span",{children:(t==null?void 0:t.funnels.first_mission_outcome)??0})]}),e.jsxs("div",{className:"gameplay-node",children:[e.jsx("span",{children:"Run outcome"}),e.jsx("span",{children:(t==null?void 0:t.funnels.run_outcome)??0})]})]}),e.jsx("div",{className:"gameplay-list",children:e.jsxs("p",{children:["Retention D1 ",((t==null?void 0:t.retention.d1_pct)??0).toFixed(2),"% • D7"," ",((t==null?void 0:t.retention.d7_pct)??0).toFixed(2),"% • D30 ",((t==null?void 0:t.retention.d30_pct)??0).toFixed(2),"%"]})}),n!=null&&n.alerts.length?e.jsx("div",{className:"gameplay-list",children:n.alerts.slice(0,3).map(s=>e.jsxs("div",{className:"gameplay-node",children:[e.jsx("span",{children:s.severity.toUpperCase()}),e.jsx("span",{children:s.message})]},s.id))}):null]})]})]})}export{we as default};
