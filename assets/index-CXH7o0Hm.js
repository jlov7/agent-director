import{r as s,j as e}from"./vendor-react-D4yGots9.js";import{S as B,e as F,f as S,g as T}from"./index-CljEJu1G.js";import"./vendor-DClHNS3s.js";function $(n){return JSON.stringify(n,null,2)}function z({traceId:n,step:a,safeExport:i,onClose:k,onReplay:R}){var C,w;const[c,A]=s.useState(null),[r,m]=s.useState("redacted"),[h,p]=s.useState([]),[x,j]=s.useState([]),[J,P]=s.useState("director"),[u,v]=s.useState(""),[D,y]=s.useState(!1),[b,N]=s.useState(!1);if(s.useEffect(()=>{p([]),m("redacted")},[a==null?void 0:a.id,i]),s.useEffect(()=>{if(!a)return;let t=!0;return(async()=>{const l=i?"redacted":r,O=await T(n,a.id,l,l==="redacted"?h:[],i);t&&A(O)})(),()=>{t=!1}},[n,a,r,i,h]),s.useEffect(()=>{if(!a)return;let t=!0;return(async()=>{const l=await S(n,a.id);t&&j(l)})(),()=>{t=!1}},[n,a]),!a)return null;const o=c==null?void 0:c.redaction,g=(o==null?void 0:o.fieldsRedacted)??[],f=(o==null?void 0:o.revealedFields)??[];return e.jsxs("aside",{className:"inspector","data-help":!0,"data-help-indicator":!0,"data-tour":"inspector","data-help-title":"Inspector panel","data-help-body":"Deep dive into a single step: payloads, redaction, metrics, and replay.","data-help-placement":"left",children:[e.jsxs("div",{className:"inspector-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"inspector-title",children:[e.jsx(B,{type:a.type,size:"md",showLabel:!0}),e.jsx("span",{children:a.name}),e.jsx("span",{className:`status-pill status-${a.status}`,children:a.status})]}),e.jsx("div",{className:"inspector-subtitle",children:a.type})]}),e.jsx("button",{className:"ghost-button",type:"button",onClick:k,"aria-label":"Close inspector",children:"Close"})]}),e.jsxs("div",{className:"inspector-section",children:[e.jsxs("div",{className:"inspector-row",children:[e.jsx("span",{children:"Status"}),e.jsx("span",{children:a.status})]}),e.jsxs("div",{className:"inspector-row",children:[e.jsx("span",{children:"Duration"}),e.jsxs("span",{children:[a.durationMs??0,"ms"]})]}),e.jsxs("div",{className:"inspector-row",children:[e.jsx("span",{children:"Tokens"}),e.jsx("span",{children:((C=a.metrics)==null?void 0:C.tokensTotal)??"-"})]}),e.jsxs("div",{className:"inspector-row",children:[e.jsx("span",{children:"Cost"}),e.jsx("span",{children:((w=a.metrics)==null?void 0:w.costUsd)!=null?`$${a.metrics.costUsd.toFixed(3)}`:"-"})]})]}),e.jsxs("div",{className:"inspector-section",children:[e.jsx("div",{className:"inspector-section-title",children:"Payload"}),e.jsxs("div",{className:"inspector-controls",children:[e.jsxs("label",{title:i?"Safe export enabled: raw view disabled.":"Toggle raw payload view.","data-help":!0,"data-help-title":"Raw payload","data-help-body":"Switch between redacted and raw payloads when Safe export is off.","data-help-placement":"top",children:[e.jsx("input",{type:"checkbox",checked:r==="raw",disabled:i,onChange:t=>m(t.target.checked?"raw":"redacted")}),"Reveal raw (dangerous)"]}),e.jsx("button",{className:"ghost-button",type:"button","aria-label":"Copy payload JSON",onClick:async()=>{c&&await navigator.clipboard.writeText(JSON.stringify(c.data,null,2))},"data-help":!0,"data-help-title":"Copy JSON","data-help-body":"Copy the payload to your clipboard.","data-help-placement":"top",children:"Copy JSON"}),h.length>0&&r==="redacted"?e.jsx("button",{className:"ghost-button",type:"button","aria-label":"Reset revealed fields",onClick:()=>p([]),"data-help":!0,"data-help-title":"Reset reveals","data-help-body":"Re-hide any fields you temporarily revealed.","data-help-placement":"top",children:"Reset reveals"}):null]}),e.jsx("pre",{className:"inspector-json",children:c?$(c.data):"Loading..."}),g.length>0?e.jsxs("div",{className:"inspector-redaction",children:["Redacted fields:",e.jsx("ul",{children:g.map(t=>{const d=!i&&r==="redacted";return e.jsxs("li",{children:[t.path," (",t.kind,")",d?e.jsx("button",{className:"ghost-button",type:"button","aria-label":`Reveal ${t.path}`,onClick:()=>p(l=>l.includes(t.path)?l:[...l,t.path]),children:"Reveal"}):null]},t.path)})}),f.length>0?e.jsxs("div",{className:"inspector-revealed",children:["Revealed:",e.jsx("ul",{children:f.map(t=>e.jsxs("li",{children:[t.path," (",t.kind,")"]},t.path))})]}):null]}):null]}),e.jsx("div",{className:"inspector-section",children:e.jsx("button",{className:"primary-button",type:"button",onClick:()=>R(a.id),"data-help":!0,"data-help-title":"Replay","data-help-body":"Branch a new run starting from this step.","data-help-placement":"top",children:"Replay from this step"})}),e.jsxs("div",{className:"inspector-section",children:[e.jsx("div",{className:"inspector-section-title",children:"Collaboration notes"}),e.jsxs("div",{className:"inspector-controls",children:[e.jsx("input",{className:"search-input",value:J,onChange:t=>P(t.target.value),placeholder:"Author","aria-label":"Comment author"}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:D,onChange:t=>y(t.target.checked)}),"Pin"]})]}),e.jsx("textarea",{className:"search-input",value:u,onChange:t=>v(t.target.value),placeholder:"Add an investigation note...","aria-label":"Comment body",rows:3}),e.jsx("div",{className:"inspector-controls",children:e.jsx("button",{className:"ghost-button",type:"button",disabled:b||!u.trim(),onClick:async()=>{if(!u.trim())return;N(!0);const t=await F(n,a.id);if(N(!1),!t)return;v(""),y(!1);const d=await S(n,a.id);j(d)},children:b?"Saving...":"Add note"})}),e.jsx("div",{className:"inspector-comments",children:x.length===0?e.jsx("div",{className:"inspector-comments-empty",children:"No notes yet."}):x.map(t=>e.jsxs("div",{className:"inspector-comment",children:[e.jsxs("div",{className:"inspector-row",children:[e.jsxs("span",{children:[t.author,t.pinned?" (pinned)":""]}),e.jsx("span",{children:new Date(t.createdAt).toLocaleString()})]}),e.jsx("div",{children:t.body})]},t.id))})]})]})}export{z as default};
